# Проектирование высоконагруженного почтового сервиса
Курсовая работа в рамках 3-го семестра программы по Веб-разработке ОЦ VK x МГТУ им. Н.Э. Баумана ("Технопарк") по дисциплине "Проектирование высоконагруженных сервисов"
##### Автор: Степаненко Полина
В качестве примера выбран сервис [Mail.ru](https://mail.ru/)

## Содержание

* ### [Тема и целевая аудитория](#1)
* ### [Расчет нагрузки](#2)

## 1. Тема и целевая аудитория <a name="1"></a>

**Mail.ru** — почтовый сервис, с возможностью чтения и отправки (с вложениями) писем.

### MVP

- Просмотр списка писем
- Чтение писем
- Отправка писем
- Прикрепление файлов(изображений, архивов)
- Удаление писем из интерфейса
- Распределение писем по разделам (отправленные, спам, соцсети и тд)

### Ключевые продуктовые решения

- Алгоритм сортировки писем по разделам (антиспам например)
- Сохранение черновика написанного сообщения при закрытом интерфейсе (например при переходе между вкладками в браузере)

### Целевая аудитория

- Россия, страны СНГ
- Средняя месячная аудитория 49.5 млн человек (по результатам 3 квартала 2023 года) [^1]
- Средняя дневная аудитория 16,5 млн (по результатам 3 квартала 2023 года) [^1]


## 2. Расчет нагрузки <a name="2"></a>

### Продуктовые метрики

|Метрика|Значение|Обозначение|
| ------------- | -------------|--|
|MAU (чел.)\[^1]|49.5 млн.|MAU|
|DAU (чел.)\[^1]|16.5 млн.|DAU|
|Средний размер хранилища\[^2]|8Гб|SIZE_ALL|
|Средний размер 1 письма|200Kб|SIZE_LETTER|
|Отправлено писем в день\[`^3]|40|LETTERS_SENT|
|Получено писем в день\[^3]|121|LETTERS_GET|
|Прикрепить файлов в день\[]|13|LETTERS_FILES|
|Просмотр страниц писем в день\[]|1|LETTERS_PAGES|
|Писем на странице\[]|25|LETTERS_PER_PAGE|


### Технические метрики

### Среднее количество действий пользователя по типам в день (RPS) (согласно MVP)

- <b>Листинг писем</b>

Согласно пунту , объем данных `1 * 25 * 100 KB = 2500 KB`:

      RPS = (16.5 * 10^6 * 1 * 25)/(24 * 60 * 60) ~ 4774

      Трафик: 4774 * 2500 ~ 11 9365 500 Kbit/sec ~ 11.38 Gbit/sec

      Пиковое значение: 2 * 11.38 ~ 22.76 Gbit/sec

- <b>Отправка/пересылка писем</b>

Согласно пунту 5, объем данных `40 * 100 KB = 4000KB`:

      RPS = (16.5 * 10^6 * 40)/(24 * 60 * 60) ~ 7638

      Трафик: 7638 * 4000 ~ 30 555 555 Kbit/sec ~ 29.14 Gbit/sec

      Пиковое значение (пункт 6): 2 * 29.14 ~ 58.28 Gbit/sec

- <b>Чтение писем</b>

Согласно пунту 6, объем данных `121 * 100 KB = 12100KB`:

      RPS = (16.5 * 10^6 * 121)/(24 * 60 * 60) ~ 23108

      Трафик: 23108 * 12100 ~ 279 602 430 Kbit/sec ~ 267 Gbit/sec

      Пиковое значение (пункт 6): 2 * 267 ~ 533 Gbit/sec

- <b>Скачивание файлов(изображений, архивов)</b>

В среднем 1 * 25 * 0.33 полученных письма имеют вложение, объем данных `1 * 25 * 0.33 * 100KB = 833KB`, тогда:

      RPS = (16.5 * 10^6 * 1 * 25 * 0,33)/(24 * 60 * 60) ~ 1591

      Трафик: 1591 * 833 ~ 1 325 665 Kbit/sec ~ 1.26 Gbit/sec

      Пиковое значение (пункт 6): 2 * 1.26 ~ 2.52 Gbit/sec

- <b>Прикрепление файлов(изображений, архивов)</b>

В среднем 40 * 0.33 отправленное письмо имеет вложение(пункт 1), объем данных `40 * 0.33 * 100KB = 1333KB`, тогда:

     RPS = (16.5 * 10^6 * 40 * 0,33)/(24 * 60 * 60) ~ 2520

      Трафик: 2520 * 1333 ~ 3 359 160 Kbit/sec ~ 3.2 Gbit/sec

      Пиковое значение (пункт 6): 2 * 3.2 ~ 6.4 Mbit/sec

- <b>Удаление писем</b>

В среднем пользователи почти никогда не удаляют сообщения

**Хранилище**

Принимая средний размер хранилища за 8Гб, а средний размер письма 200Кб получаем:

`(8 * 1024 * 1024) / 200 ~ 42000`

| Размер хранилища | Среднее количество писем в ящике |
|------------------|----------------------------------|
| 8 GB            | 42000                            |

## Список литературы

[^1]: [Ежемесячная аудитория Почты Mail.ru](https://vk.company/ru/investors/results/)
[^2]: [Размер почтового ящика](https://help.mail.ru/mail/settings/size/)
[^3]: [Сколько электронных писем отправляется в день?](https://prosperitymedia.com.au/how-many-emails-are-sent-per-day-in-2024/)
